/*! ajax-html-loader - v0.1.2 - 2015-08-05
* Copyright (c) 2015 Benjamin GrÃ¶ner @ b:dreizehn Licensed  */
define("ajax-html-loader",[],function(){function a(){var a={};for(var b in arguments){var c=arguments[b];for(var d in c)a[d]=c[d]}return a}function b(a,b){return a?(" "+a.className+" ").indexOf(" "+b+" ")>-1:!1}var c=function(a,b){this._initialize(a,b)};return c.prototype={attributeOptionsMapping:{actionType:"data-alaction",ajaxSource:"data-alajaxsource",sourceSelector:"data-alsourceselector",targetSelector:"data-altargetselector",httpMethod:"data-almethod",httpParams:"data-alparams",showLoader:"data-alloader",loaderClass:"data-alloaderclass",loaderTargetSelector:"data-alloadertarget",group:"data-algroup",initLoading:"data-alinitloading"},defaultOpts:{actionType:"append",ajaxSource:"",sourceSelector:"al_source",targetSelector:"al_target",httpMethod:"GET",httpParams:"",showLoader:!1,loaderClass:"al_loader",loaderTargetSelector:"body",group:"",initLoading:!1},_groupStates:{},_anonymousGroupCount:0,_initialize:function(b,c){if(this.el=b,this.opts=a(this.defaultOpts,this._getOptionsFromAttributes(),this._getFormBasedOptions(),c),this._beforeLoadingHandlers=[],this._onLoadingHandlers=[],this._onLoadingSuccessHandlers=[],this._onLoadingErrorhandlers=[],this.opts.beforeLoading)if("function"==typeof this.opts.beforeLoading)this.registerBeforeLoading(this.opts.beforeLoading);else if(this.opts.beforeLoading instanceof Array)for(var d in this.opts.beforeLoading)"function"==typeof this.opts.beforeLoading[d]&&this.registerBeforeLoading(this.opts.beforeLoading[d]);if(this.opts.onLoading)if("function"==typeof this.opts.onLoading)this.registerOnLoading(this.opts.onLoading);else if(this.opts.onLoading instanceof Array)for(var d in this.opts.onLoading)"function"==typeof this.opts.onLoading[d]&&this.registerOnLoading(this.opts.onLoading[d]);if(this.opts.onLoadingSuccess)if("function"==typeof this.opts.onLoadingSuccess)this.registerOnLoadingSuccess(this.opts.onLoadingSuccess);else if(this.opts.onLoadingSuccess instanceof Array)for(var d in this.opts.onLoadingSuccess)"function"==typeof this.opts.onLoadingSuccess[d]&&this.registerOnLoadingSuccess(this.opts.onLoadingSuccess[d]);if(this.opts.onLoadingError)if("function"==typeof this.opts.onLoadingError)this.registerOnLoadingError(this.opts.onLoadingError);else if(this.opts.onLoadingError instanceof Array)for(var d in this.opts.onLoadingError)"function"==typeof this.opts.onLoadingError[d]&&this.registerOnLoadingError(this.opts.onLoadingError[d]);this._bindEvents(),this.doLoadInitially()&&this.triggerContentLoading()},_bindEvents:function(){var a=this,b=function(){a._handleClickEvent.apply(a,arguments)};this.el.addEventListener?this.el.addEventListener("click",b):this.el.attachEvent&&this.el.attachEvent("onclick",b)},_handleClickEvent:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1,this.triggerContentLoading()},_handleContentLoadSuccess:function(a,b){var c=this.getActionType(),d=this._extractContentFromResponseHTML(a);"append"===c?this.appendContent(d):"replace"===c&&this.replaceContent(d)},_createXHR:function(){var a;if(window.ActiveXObject)try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){a=null}else a=new XMLHttpRequest;return a},_extractContentFromResponseHTML:function(a){var b=document.createElement("div"),c=this.getSourceSelector();return b.innerHTML=a,b.querySelector(c)},_getFormBasedOptions:function(){var a={},b=this.el.getAttribute("type");if(b&&"submit"===b){var c=this.getParentForm();if(c){var d=c.getAttribute("action"),e=c.getAttribute("method");d&&(a.ajaxSource=d),e&&(a.httpMethod=e.toUpperCase())}}return a},_getOptionsFromAttributes:function(){var a={};for(var b in this.attributeOptionsMapping){var c=this.attributeOptionsMapping[b],d=this.el.getAttribute(c);"true"===d&&(d=!0),"false"===d&&(d=!1),"undefined"!=typeof d&&null!==d&&""!==d&&(a[b]=d)}return a},_getGroupState:function(a){return this._groupStates[a]||(this._groupStates[a]={requestCount:0}),this._groupStates[a]},_setGroupState:function(b,c){this._groupStates[b]=a(this._getGroupState(),c)},getAjaxSource:function(){var a,b=this.el.getAttribute("type");if(b&&"submit"===b){var c=this.getParentForm();c&&(a=c.getAttribute("action"))}return this.getOption("ajaxSource")||this.el.getAttribute("href")||a},getActionType:function(){return this.getOption("actionType")},getSourceSelector:function(){return this.getOption("sourceSelector")},getTargetSelector:function(){return this.getOption("targetSelector")},getHttpMethod:function(){var a,b=this.el.getAttribute("type");if(b&&"submit"===b){var c=this.getParentForm();c&&(a=c.getAttribute("method")),a&&(a=a.toUpperCase())}return this.getOption("httpMethod")||a},getHttpParams:function(){var a=this.el.getAttribute("type"),b=this.getOption("httpParams");if(a&&"submit"===a){var c=this.getParentForm(),d="";if(c){var e=this.getFormValues(c);for(var f in e)d+="&"+f+"="+e[f]}b.length||(d=d.substring(1)),b+=d}return b},doShowLoader:function(){return this.getOption("showLoader")},getLoaderClass:function(){return this.getOption("loaderClass")},getLoaderTargetSelector:function(){return this.getOption("loaderTargetSelector")},getTargetElements:function(){var a=this.getTargetSelector();return document.querySelectorAll(a)},getRequestUrl:function(a){var b=this.getHttpMethod(),c=this.getAjaxSource(),d=this.getHttpParams();if("GET"==b&&d&&d.length)if(a)c+=d;else{var e="",f=d.split("&");for(var g in f){var h=f[g].split("=");h[0]&&(e+=encodeURIComponent(h[0])+"=",h[1]&&(e+=encodeURIComponent(h[1])),g<f.length-1&&(e+="&"))}c+=c.indexOf("?")>=0?"&":"?",c+=e}return c},getGroupName:function(){var a=this.getOption("group")||this._privateGroup;return a||(this._anonymousGroupCount++,a="__al-group-"+this._anonymousGroupCount+"__",this._privateGroup=a),a},getValidator:function(){return this.getOption("validator",!0)},getParentForm:function(){for(var a=void 0,b=this.el;!a&&b.parentElement;)"FORM"==b.parentElement.tagName?a=b.parentElement:b=b.parentElement;return a},doLoadInitially:function(){return this.getOption("initLoading")},getFormValues:function(a){var b=!1;if(a){b={};for(var c=0;c<a.elements.length;c++){var d=a.elements[c],e=d.tagName,f=d.getAttribute("type"),g=d.getAttribute("name");if("INPUT"==e||"TEXTAREA"==e)("radio"!=f&&"checkbox"!=f||d.checked)&&d.value&&(b[g]=d.value);else if("SELECT"==e&&d.selectedIndex>=0){var h=d.options[d.selectedIndex];b[g]=h.value||h.text}}}if("submit"==this.el.getAttribute("type")){var i=this.el.getAttribute("name"),j=this.el.value;"undefined"!=typeof j&&null!==j&&(b[i]=j)}return b},getOptions:function(){return a(this.opts)},getOption:function(a,b){var c=this.opts[a];return b||"function"!=typeof c?c:c.call(this)},setOptions:function(b){this.opts=a(this.opts,b)},triggerContentLoading:function(){var a=this,b=this.getOptions();this.loadAjaxContent(b,function(b,c){a._handleContentLoadSuccess.call(a,b,c)})},loadAjaxContent:function(a,c,d){var e,f=this,g=this._createXHR(),h=this.getHttpMethod(),i=this.getHttpParams(),j=this.getRequestUrl(),k=this.getLoaderClass(),l=this.getLoaderTargetSelector(),m=document.querySelector(l),e=this._requestCount=this._requestCount+1,n=this.getGroupName(),o=this.getValidator();if("function"!=typeof o||o()){if(n){var p=this._getGroupState(n);e=p.requestCount+1,p.currentRequest&&p.currentRequest.abort(),this._setGroupState(n,{requestCount:e,currentRequest:g})}for(var q in f._beforeLoadingHandlers)"function"==typeof f._beforeLoadingHandlers[q]&&f._beforeLoadingHandlers[q].call(f,f);this.doShowLoader()&&m&&!b(m,k)&&(m.className.length&&(m.className+=" "),m.className+=k),g.onreadystatechange=function(){if(4==g.readyState){if(n&&e&&f._getGroupState(n).requestCount!=e)return;if(200==g.status){"function"==typeof c&&c.call(f,g.responseText,g);for(var a in f._onLoadingSuccessHandlers)"function"==typeof f._onLoadingSuccessHandlers[a]&&f._onLoadingSuccessHandlers[a].call(f,g.responseText,g,f)}else{"function"==typeof d&&d.call(f,g.responseText,g);for(var a in f._onLoadingErrorhandlers)"function"==typeof f._onLoadingErrorhandlers[a]&&f._onLoadingErrorhandlers[a].call(f,g.responseText,g,f)}for(var a in f._onLoadingHandlers)"function"==typeof f._onLoadingHandlers[a]&&f._onLoadingHandlers[a].call(f,g.responseText,g,f);if(b(m,k)){var h=new RegExp(" ?"+k),i=m.className.match(h);m.className=m.className.replace(i,"")}}},g.open(h,j,!0),g.setRequestHeader("Content-type","application/x-www-form-urlencoded"),"GET"==h?g.send():g.send(i)}},appendContent:function(a){var b=this.getTargetSelector(),c=document.querySelector(b);if(a&&c)for(;a.firstChild;)c.appendChild(a.firstChild)},replaceContent:function(a){var b=this.getTargetSelector(),c=document.querySelector(b);if(a){for(;c.firstChild;)c.removeChild(c.firstChild);for(;a.firstChild;)c.appendChild(a.firstChild)}},registerBeforeLoading:function(a){return"function"==typeof a?(this._beforeLoadingHandlers.push(a),a):void 0},unregisterBeforeLoading:function(a){var b=this._beforeLoadingHandlers.indexOf(a);return b>=0?(this._beforeLoadingHandlers.splice(b,1),a):void 0},registerOnLoading:function(a){return"function"==typeof a?(this._onLoadingHandlers.push(a),a):void 0},unRegisterOnLoading:function(a){var b=this._onLoadingHandlers.indexOf(a);return b>=0?(this._onLoadingHandlers.splice(b,1),a):void 0},registerOnLoadingSuccess:function(a){return"function"==typeof a?(this._onLoadingSuccessHandlers.push(a),a):void 0},unRegisterOnLoadingSuccess:function(a){var b=this._onLoadingSuccessHandlers.indexOf(a);return b>=0?(this._onLoadingSuccessHandlers.splice(b,1),a):void 0},registerOnLoadingError:function(a){return"function"==typeof a?(this._onLoadingErrorhandlers.push(a),a):void 0},unRegisterOnLoadingError:function(a){var b=this._onLoadingErrorhandlers.indexOf(a);return b>=0?(this._onLoadingErrorhandlers.splice(b,1),a):void 0}},c});