/*! ajax-html-loader - v0.0.3 - 2015-07-20
* Copyright (c) 2015 Benjamin GrÃ¶ner @ b:dreizehn Licensed  */
define("ajax-html-loader",[],function(){function a(){var a={};for(var b in arguments){var c=arguments[b];for(var d in c)a[d]=c[d]}return a}function b(a,b){return(" "+a.className+" ").indexOf(" "+b+" ")>-1}var c=function(a,b){this._initialize(a,b)};return c.prototype={attributeOptionsMapping:{actionType:"data-alaction",ajaxSource:"data-alajaxsource",sourceSelector:"data-alsourceselector",targetSelector:"data-altargetselector",httpMethod:"data-almethod",httpParams:"data-alparams",showLoader:"data-alloader",loaderClass:"data-alloaderclass",loaderTargetSelector:"data-alloadertarget",group:"data-algroup"},defaultOpts:{actionType:"append",ajaxSource:"",sourceSelector:"al_source",targetSelector:"al_target",httpMethod:"GET",httpParams:"",showLoader:!1,loaderClass:"al_loader",loaderTargetSelector:"body",group:""},_groupStates:{},_initialize:function(b,c){this.el=b,this.opts=a(this.defaultOpts,this._getOptionsFromDataAttributes(),c),this._bindEvents()},_bindEvents:function(){var a=this,b=function(){a._handleClickEvent.apply(a,arguments)};this.el.addEventListener?this.el.addEventListener("click",b):this.el.attachEvent&&this.el.attachEvent("onclick",b)},_handleClickEvent:function(a){var b=this,c=this.getOptions();a.preventDefault(),this.loadAjaxContent(c,function(a,c){b._handleContentLoadSuccess.call(b,a,c)})},_handleContentLoadSuccess:function(a,b){var c=this.getActionType(),d=this._extractContentFromResponseHTML(a);"append"===c?this.appendContent(d):"replace"===c&&this.replaceContent(d)},_createXHR:function(){var a;if(window.ActiveXObject)try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){a=null}else a=new XMLHttpRequest;return a},_extractContentFromResponseHTML:function(a){var b=document.createElement("html"),c=this.getSourceSelector();return b.innerHTML=a,b.querySelector(c)},_getOptionsFromDataAttributes:function(){var a={};for(var b in this.attributeOptionsMapping){var c=this.attributeOptionsMapping[b],d=this.el.getAttribute(c);"undefined"!=typeof d&&null!==d&&""!==d&&(a[b]=d)}return a},_getGroupState:function(a){return this._groupStates[a]||(this._groupStates[a]={requestCount:0}),this._groupStates[a]},_setGroupState:function(b,c){this._groupStates[b]=a(this._getGroupState(),c)},getAjaxSource:function(){return this.getOption("ajaxSource")||this.el.getAttribute("href")},getActionType:function(){return this.getOption("actionType")},getSourceSelector:function(){return this.getOption("sourceSelector")},getTargetSelector:function(){return this.getOption("targetSelector")},getHttpMethod:function(){return this.getOption("httpMethod")},getHttpParams:function(){return this.getOption("httpParams")},doShowLoader:function(){return this.getOption("showLoader")},getLoaderClass:function(){return this.getOption("loaderClass")},getLoaderTargetSelector:function(){return this.getOption("loaderTargetSelector")},getTargetElements:function(){var a=this.getTargetSelector();return document.querySelectorAll(a)},getRequestUrl:function(){var a=this.getHttpMethod(),b=this.getAjaxSource(),c=this.getHttpParams();return"GET"==a&&c&&c.length&&(b+=b.indexOf("?")>=0?"&":"?",b+=c),b},getGroupName:function(){return this.getOption("group")||!1},getOptions:function(){return a(this.opts)},getOption:function(a,b){var c=this.opts[a];return b||"function"!=typeof c?c:c.call(this)},setOptions:function(b){this.opts=a(this.opts,b)},loadAjaxContent:function(a,c,d){var e,f=this,g=this._createXHR(),h=this.getHttpMethod(),i=this.getHttpParams(),j=this.getRequestUrl(),k=this.getLoaderClass(),l=this.getLoaderTargetSelector(),m=document.querySelector(l),e=this._requestCount=this._requestCount+1,n=this.getGroupName();if(n){var o=this._getGroupState(n);e=o.requestCount+1,o.currentRequest&&o.currentRequest.abort(),this._setGroupState(n,{requestCount:e,currentRequest:g})}this.doShowLoader()&&(b(m,k)||(m.className.length&&(m.className+=" "),m.className+=k)),g.onreadystatechange=function(){if(4==g.readyState){if(n&&e&&f._getGroupState(n).requestCount!=e)return;if(200==g.status?"function"==typeof c&&c.call(f,g.responseText,g):"function"==typeof d&&d.call(f,g.responseText,g),b(m,k)){var a=new RegExp(" ?"+k),h=m.className.match(a);m.className=m.className.replace(h,"")}}},g.open(h,j,!0),g.setRequestHeader("Content-type","application/x-www-form-urlencoded"),"GET"==h?g.send():g.send(i)},appendContent:function(a){var b=this.getTargetSelector(),c=document.querySelector(b);if(a)for(;a.firstChild;)c.appendChild(a.firstChild)},replaceContent:function(a){var b=this.getTargetSelector(),c=document.querySelector(b);if(a){for(;c.firstChild;)c.removeChild(c.firstChild);for(;a.firstChild;)c.appendChild(a.firstChild)}}},c});